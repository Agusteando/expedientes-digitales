generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  superadmin
  admin
  employee
  candidate
}

model Plantel {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

model User {
  id             Int             @id @default(autoincrement())
  name           String
  email          String          @unique
  picture        String?
  passwordHash   String? // for non-admin/candidate login
  rfc            String?
  curp           String?
  role           Role            @default(candidate)
  isActive       Boolean         @default(true)
  plantelId      Int?
  plantel        Plantel?        @relation(fields: [plantelId], references: [id])
  canSign        Boolean         @default(false)
  isApproved     Boolean         @default(false)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  documents      Document[]
  checklistItems ChecklistItem[]
  signatures     Signature[]
}

model Document {
  id             String          @id @default(cuid())
  userId         Int
  user           User            @relation(fields: [userId], references: [id])
  type           String
  status         String          @default("PENDING")
  filePath       String
  uploadedAt     DateTime        @default(now())
  version        Int
  reviewComment  String?
  checklistItems ChecklistItem[]
}

model ChecklistItem {
  id         String    @id @default(cuid())
  userId     Int
  user       User      @relation(fields: [userId], references: [id])
  documentId String? // optional, assigned after upload
  document   Document? @relation(fields: [documentId], references: [id])
  type       String
  required   Boolean   @default(true)
  fulfilled  Boolean   @default(false)
}

model Signature {
  id         String    @id @default(cuid())
  userId     Int
  user       User      @relation(fields: [userId], references: [id])
  type       String
  status     String
  signedAt   DateTime?
  mifielData Json?
  createdAt  DateTime  @default(now())
}
